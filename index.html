<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#050505">
    <title>VIP Event Dashboard</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&family=JetBrains+Mono:wght@500;700;800&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* --- æ ¸å¿ƒè‰²ç³»ï¼šæ·±é‚ƒé»‘é‡‘ --- */
            --bg-body: #050505;
            --surface-glass: rgba(20, 20, 25, 0.75);
            --surface-border: rgba(255, 255, 255, 0.08);
            
            /* --- å“ç‰Œè‰² (æµé‡‘) --- */
            --gold-light: #FCEDA3;
            --gold-main: #EAB308;
            --gold-dark: #A16207;
            
            /* --- æ–‡å­— --- */
            --text-primary: #FFFFFF;
            --text-secondary: #A1A1AA;
            --text-tertiary: #52525B;
            
            /* --- å°ºå¯¸ --- */
            --radius-xl: 24px;
            --radius-lg: 16px;
            --radius-md: 8px;
        }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0; padding-bottom: env(safe-area-inset-bottom, 20px);
            background-color: var(--bg-body);
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- èƒŒæ™¯ç‰¹æ•ˆ (Aurora Background) --- */
        .bg-glow {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1;
            background: 
                radial-gradient(circle at 15% 15%, rgba(234, 179, 8, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 85% 30%, rgba(59, 130, 246, 0.05) 0%, transparent 40%),
                radial-gradient(circle at 50% 90%, rgba(234, 179, 8, 0.05) 0%, transparent 50%);
            filter: blur(60px);
        }

        .container {
            max-width: 480px; margin: 0 auto; padding: 24px 20px 80px 20px;
            display: flex; flex-direction: column; gap: 24px;
        }

        /* --- Language Switcher --- */
        .lang-switch {
            position: absolute; top: 20px; right: 20px; z-index: 50; display: flex; gap: 6px;
        }
        .lang-btn {
            background: rgba(0,0,0,0.4); border: 1px solid var(--surface-border);
            color: var(--text-secondary); padding: 6px 10px; border-radius: 20px;
            font-size: 11px; font-weight: 600; cursor: pointer; backdrop-filter: blur(8px);
            transition: all 0.3s;
        }
        .lang-btn.active {
            background: var(--gold-main); color: #000; border-color: var(--gold-main);
            box-shadow: 0 0 12px rgba(234, 179, 8, 0.4);
        }

        /* --- Header --- */
        .header { margin-top: 40px; margin-bottom: 12px; text-align: left; }
        .title {
            font-size: 32px; font-weight: 800; margin: 0 0 8px 0; line-height: 1.1;
            background: linear-gradient(135deg, #FFFFFF 30%, var(--gold-light) 70%, var(--gold-main) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .subtitle { font-size: 14px; color: var(--text-secondary); margin: 0; }
        
        .user-pill {
            display: inline-flex; align-items: center; gap: 6px; margin-top: 12px;
            padding: 4px 10px; background: rgba(255,255,255,0.03); border: 1px solid var(--surface-border);
            border-radius: 99px; font-size: 11px; font-family: 'JetBrains Mono', monospace; color: var(--text-secondary);
        }
        .status-dot { width: 6px; height: 6px; border-radius: 50%; background: #10B981; box-shadow: 0 0 8px #10B981; animation: pulse 2s infinite; }

        /* --- Card System --- */
        .card {
            background: var(--surface-glass); backdrop-filter: blur(20px);
            border: 1px solid var(--surface-border); border-radius: var(--radius-xl);
            padding: 24px; position: relative; overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        }

        /* --- Hero Section --- */
        .hero-label { font-size: 12px; text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-secondary); font-weight: 600; margin-bottom: 8px; }
        .hero-value-container { display: flex; align-items: baseline; gap: 4px; margin-bottom: 24px; }
        .hero-value {
            font-family: 'JetBrains Mono', monospace; font-size: 48px; font-weight: 800;
            background: linear-gradient(180deg, #FFFFFF 0%, var(--gold-light) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 10px 30px rgba(234, 179, 8, 0.15);
        }
        .hero-unit { font-size: 14px; color: var(--text-tertiary); font-weight: 600; transform: translateY(-8px); }

        /* --- Progress Bar --- */
        .progress-box { position: relative; }
        .progress-info { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 8px; font-weight: 600; color: var(--text-secondary); }
        .progress-track { height: 6px; background: rgba(255,255,255,0.06); border-radius: 10px; overflow: hidden; }
        .progress-fill {
            height: 100%; width: 0%; border-radius: 10px;
            background: linear-gradient(90deg, var(--gold-dark), var(--gold-main));
            box-shadow: 0 0 15px rgba(234, 179, 8, 0.4);
            transition: width 1.2s cubic-bezier(0.22, 1, 0.36, 1);
        }

        /* --- Tier List --- */
        .section-title { font-size: 16px; font-weight: 700; margin: 8px 0 16px 0; color: var(--text-primary); display: flex; align-items: center; gap: 8px; }
        .section-icon { color: var(--gold-main); }
        .tier-list { display: flex; flex-direction: column; gap: 8px; }
        .tier-item {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.03);
            padding: 14px 18px; border-radius: var(--radius-lg); transition: all 0.3s;
        }
        .tier-item.active {
            background: rgba(234, 179, 8, 0.08); border-color: rgba(234, 179, 8, 0.3);
            box-shadow: inset 0 0 20px rgba(234, 179, 8, 0.05);
        }
        .tier-info { display: flex; flex-direction: column; gap: 2px; }
        .tier-name { font-size: 14px; font-weight: 700; }
        .tier-req { font-size: 11px; color: var(--text-tertiary); font-family: 'JetBrains Mono', monospace; }
        .tier-badge {
            font-size: 10px; font-weight: 700; padding: 4px 8px; border-radius: 6px;
            background: rgba(255,255,255,0.05); color: var(--text-tertiary);
        }
        .tier-item.active .tier-badge { background: var(--gold-main); color: #000; box-shadow: 0 2px 10px rgba(234, 179, 8, 0.3); }

        /* --- History Table (Fixed Version) --- */
        .history-card-custom {
            padding: 0 !important; /* Remove card padding */
            display: flex; flex-direction: column;
        }
        .history-header-area { padding: 24px 24px 10px 24px; }
        
        .table-container { width: 100%; overflow-x: auto; }
        .history-table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        
        .history-table th {
            text-align: left; font-size: 11px; text-transform: uppercase; color: var(--text-tertiary);
            padding: 14px 24px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-weight: 600; background: rgba(255, 255, 255, 0.02);
        }
        .history-table td {
            padding: 16px 24px; border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            color: var(--text-secondary); font-size: 14px; vertical-align: middle;
        }
        .history-table tr:last-child td { border-bottom: none; }

        /* Value Cell Alignment */
        .val-cell-wrapper { display: flex; align-items: center; justify-content: flex-end; gap: 8px; }
        .val-text { font-family: 'JetBrains Mono', monospace; color: var(--text-primary); font-weight: 600; font-size: 15px; }
        .rank-dot { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }

        /* --- Footer --- */
        .footer { margin-top: 20px; border-top: 1px solid var(--surface-border); padding-top: 24px; color: var(--text-tertiary); font-size: 12px; line-height: 1.6; }
        .footer ul { padding-left: 18px; margin: 12px 0; }
        
        /* --- Animation & Skeleton --- */
        @keyframes pulse { 0% { opacity: 0.5; box-shadow: 0 0 0 #10B981; } 50% { opacity: 1; box-shadow: 0 0 10px #10B981; } 100% { opacity: 0.5; box-shadow: 0 0 0 #10B981; } }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        
        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.03) 25%, rgba(255,255,255,0.08) 50%, rgba(255,255,255,0.03) 75%);
            background-size: 200% 100%; animation: shimmer 1.5s infinite;
            color: transparent !important; border-radius: 4px; display: inline-block;
        }
        
        .error-toast {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(220, 38, 38, 0.9); color: white; padding: 12px 20px;
            border-radius: 50px; font-size: 13px; display: none; z-index: 100;
        }
    </style>
</head>
<body>
    <div class="bg-glow"></div>

    <!-- Language -->
    <div class="lang-switch">
        <button class="lang-btn active" onclick="app.setLang('zh-TW')">ç¹</button>
        <button class="lang-btn" onclick="app.setLang('zh-CN')">ç®€</button>
        <button class="lang-btn" onclick="app.setLang('en')">EN</button>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="title" data-i18n="title">æ´»å‹•æ•¸æ“š<br>å„€è¡¨æ¿</h1>
            <p class="subtitle" data-i18n="subtitle">æŸ¥è©¢æ¯æ—¥ä¸‹æ³¨æ•¸æ“šèˆ‡ç­‰ç´š</p>
            <div class="user-pill">
                <div class="status-dot"></div>
                <span id="userIdDisplay">Connecting...</span>
            </div>
        </header>

        <!-- Main Card -->
        <div class="card">
            <div class="hero-label" data-i18n="hero_label">ğŸ“… æœ€æ–°å–®æ—¥ä¸‹æ³¨</div>
            <div class="hero-value-container">
                <div class="hero-value skeleton" id="val-bet-total">00,000</div>
                <span class="hero-unit">PTS</span>
            </div>
            <!-- Progress -->
            <div class="progress-box">
                <div class="progress-info">
                    <span id="rank-status">Loading...</span>
                    <span id="next-diff" style="color: var(--text-tertiary)">---</span>
                </div>
                <div class="progress-track">
                    <div class="progress-fill" id="progress-bar"></div>
                </div>
            </div>
        </div>

        <!-- Tier List -->
        <div>
            <div class="section-title">
                <span class="section-icon">ğŸ†</span> 
                <span data-i18n="tier_title">ç­‰ç´šé–€æª»</span>
            </div>
            <div class="tier-list">
                <div class="tier-item" id="tier-A">
                    <div class="tier-info">
                        <span class="tier-name">Rank A</span>
                        <span class="tier-req" data-i18n="tier_a_range">Daily â‰¥ 20,000</span>
                    </div>
                    <span class="tier-badge">A</span>
                </div>
                <div class="tier-item" id="tier-B">
                    <div class="tier-info">
                        <span class="tier-name">Rank B</span>
                        <span class="tier-req" data-i18n="tier_b_range">Daily â‰¥ 10,000</span>
                    </div>
                    <span class="tier-badge">B</span>
                </div>
                <div class="tier-item" id="tier-C">
                    <div class="tier-info">
                        <span class="tier-name">Rank C</span>
                        <span class="tier-req" data-i18n="tier_c_range">Daily â‰¥ 5,000</span>
                    </div>
                    <span class="tier-badge">C</span>
                </div>
            </div>
        </div>

        <!-- History Table (Corrected Structure) -->
        <div class="card history-card-custom">
            <div class="history-header-area">
                <div class="section-title" style="margin: 0;">
                    <span class="section-icon">ğŸ“…</span> 
                    <span data-i18n="history_title">æ¯æ—¥æ˜ç´°</span>
                </div>
            </div>
            <div class="table-container">
                <table class="history-table">
                    <thead>
                        <tr>
                            <th style="width: 40%;" data-i18n="table_date">æ—¥æœŸ</th>
                            <th style="width: 60%; text-align: right;" data-i18n="table_amount">é‡‘é¡</th>
                        </tr>
                    </thead>
                    <tbody id="history-tbody">
                        <tr><td colspan="2" style="text-align:center; padding:30px; color:var(--text-tertiary);">Loading Data...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <strong style="color:var(--text-secondary)" data-i18n="footer_title">â„¹ï¸ æ³¨æ„äº‹é …</strong>
            <ul>
                <li data-i18n="rule_1">çµ±è¨ˆæœŸé–“ï¼š11/30 ~ 12/02</li>
                <li data-i18n="rule_2">æ•¸æ“šæ¯ 1 åˆ†é˜æ›´æ–°ä¸€æ¬¡</li>
            </ul>
            <div style="opacity: 0.4; text-align: center; margin-top: 20px;">ID: <span id="debug-id">--</span></div>
        </footer>
    </div>

    <!-- Toast -->
    <div id="error-toast" class="error-toast">Connection Error</div>

    <script>
        const API_BASE = "https://bq-betting-api-905468082258.asia-east1.run.app";
        const DEMO_ID = "58f6067b4e0c6b3b3e2f8215";

        const fmt = (n) => new Intl.NumberFormat('en-US').format(n);
        
        const TRANSLATIONS = {
            'zh-TW': {
                title: 'æ´»å‹•æ•¸æ“š<br>å„€è¡¨æ¿', subtitle: 'æŸ¥è©¢æ¯æ—¥ä¸‹æ³¨æ•¸æ“šèˆ‡ç­‰ç´š',
                hero_label: 'ğŸ“… æœ€æ–°å–®æ—¥ä¸‹æ³¨',
                tier_title: 'ç­‰ç´šé–€æª»', tier_a_range: 'ç•¶æ—¥ â‰¥ 20,000', tier_b_range: 'ç•¶æ—¥ â‰¥ 10,000', tier_c_range: 'ç•¶æ—¥ â‰¥ 5,000',
                history_title: 'æ¯æ—¥æ˜ç´°', table_date: 'æ—¥æœŸ', table_amount: 'ä¸‹æ³¨ç¸½é¡',
                footer_title: 'â„¹ï¸ æ³¨æ„äº‹é …', rule_1: 'çµ±è¨ˆæœŸé–“ï¼š11/30 ~ 12/02', rule_2: 'æ•¸æ“šæ¯ 1 åˆ†é˜æ›´æ–°ä¸€æ¬¡',
                rank_cur: 'ç›®å‰ç­‰ç´š', rank_max: 'æœ€é«˜ç­‰ç´š', next_diff: 'å·® {n} å‡ç´š'
            },
            'zh-CN': {
                title: 'æ´»åŠ¨æ•°æ®<br>ä»ªè¡¨æ¿', subtitle: 'æŸ¥è¯¢æ¯æ—¥ä¸‹æ³¨æ•°æ®ä¸ç­‰çº§',
                hero_label: 'ğŸ“… æœ€æ–°å•æ—¥ä¸‹æ³¨',
                tier_title: 'ç­‰çº§é—¨æ§›', tier_a_range: 'å½“æ—¥ â‰¥ 20,000', tier_b_range: 'å½“æ—¥ â‰¥ 10,000', tier_c_range: 'å½“æ—¥ â‰¥ 5,000',
                history_title: 'æ¯æ—¥æ˜ç»†', table_date: 'æ—¥æœŸ', table_amount: 'ä¸‹æ³¨æ€»é¢',
                footer_title: 'â„¹ï¸ æ³¨æ„äº‹é¡¹', rule_1: 'ç»Ÿè®¡æœŸé—´ï¼š11/30 ~ 12/02', rule_2: 'æ•°æ®æ¯ 1 åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡',
                rank_cur: 'å½“å‰ç­‰çº§', rank_max: 'æœ€é«˜ç­‰çº§', next_diff: 'å·® {n} å‡çº§'
            },
            'en': {
                title: 'Event Data<br>Dashboard', subtitle: 'Daily bets & Tier status',
                hero_label: 'ğŸ“… Latest Daily Bet',
                tier_title: 'Tiers', tier_a_range: 'Daily â‰¥ 20,000', tier_b_range: 'Daily â‰¥ 10,000', tier_c_range: 'Daily â‰¥ 5,000',
                history_title: 'History', table_date: 'Date', table_amount: 'Total Bet',
                footer_title: 'â„¹ï¸ Info', rule_1: 'Period: 11/30 ~ 12/02', rule_2: 'Updates every minute',
                rank_cur: 'Current Rank', rank_max: 'Max Tier', next_diff: '{n} to next'
            }
        };

        const app = {
            lang: 'zh-TW',
            setLang: (l) => {
                app.lang = l;
                document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                const idx = ['zh-TW', 'zh-CN', 'en'].indexOf(l);
                if(idx >=0) document.querySelectorAll('.lang-btn')[idx].classList.add('active');
                
                const t = TRANSLATIONS[l];
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const k = el.getAttribute('data-i18n');
                    if(t[k]) el.innerHTML = t[k];
                });
                if(window.lastData) app.render(window.lastData);
            },

            getUserId: () => {
                const params = new URLSearchParams(window.location.search);
                if (params.get('user_id')) return params.get('user_id');
                const match = window.location.hash.match(/user_id=([a-fA-F0-9]{24})/);
                if (match) return match[1];
                return DEMO_ID;
            },

            showError: (msg) => {
                const toast = document.getElementById('error-toast');
                toast.innerText = msg;
                toast.style.display = 'block';
                setTimeout(() => toast.style.display = 'none', 4000);
            },

            calcStatus: (amount) => {
                if (amount >= 20000) return { pct: 100, next: 0, rank: 'A' };
                if (amount >= 10000) return { pct: (amount/20000)*100, next: 20000 - amount, rank: 'B' };
                if (amount >= 5000) return { pct: (amount/10000)*100, next: 10000 - amount, rank: 'C' };
                return { pct: (amount/5000)*100, next: 5000 - amount, rank: 'N/A' };
            },

            render: (data) => {
                window.lastData = data;
                const t = TRANSLATIONS[app.lang];
                const list = data.data || [];
                const latest = list.length > 0 ? list[list.length - 1] : { total_bet: 0 };
                const amount = latest.total_bet || 0;

                // Hero
                document.querySelectorAll('.skeleton').forEach(el => el.classList.remove('skeleton'));
                document.getElementById('val-bet-total').innerText = fmt(amount);

                // Progress
                const st = app.calcStatus(amount);
                document.getElementById('progress-bar').style.width = `${st.pct}%`;
                
                const rankHtml = st.rank !== 'N/A' ? `<span style="color:var(--gold-main)">${st.rank}</span>` : st.rank;
                document.getElementById('rank-status').innerHTML = `${t.rank_cur}: ${rankHtml}`;

                const nextEl = document.getElementById('next-diff');
                if (st.next <= 0) {
                    nextEl.innerText = t.rank_max;
                    nextEl.style.color = 'var(--gold-main)';
                } else {
                    nextEl.innerText = t.next_diff.replace('{n}', fmt(st.next));
                    nextEl.style.color = 'var(--text-tertiary)';
                }

                // Tiers
                document.querySelectorAll('.tier-item').forEach(el => el.classList.remove('active'));
                if (amount >= 20000) document.getElementById('tier-A').classList.add('active');
                else if (amount >= 10000) document.getElementById('tier-B').classList.add('active');
                else if (amount >= 5000) document.getElementById('tier-C').classList.add('active');

                // Table
                const tbody = document.getElementById('history-tbody');
                tbody.innerHTML = '';
                if (list.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="2" style="text-align:center; padding:30px; color:var(--text-tertiary);">No Record</td></tr>`;
                } else {
                    [...list].reverse().forEach(row => {
                        const tr = document.createElement('tr');
                        const rSt = app.calcStatus(row.total_bet || 0);
                        
                        let dotColor = 'transparent';
                        let boxShadow = 'none';
                        if (rSt.rank === 'A') { dotColor = '#EAB308'; boxShadow = '0 0 8px rgba(234, 179, 8, 0.6)'; }
                        else if (rSt.rank === 'B') { dotColor = '#A1A1AA'; }
                        else if (rSt.rank === 'C') { dotColor = '#52525B'; }

                        tr.innerHTML = `
                            <td>${row.date}</td>
                            <td>
                                <div class="val-cell-wrapper">
                                    <span class="val-text">${fmt(row.total_bet)}</span>
                                    <div class="rank-dot" style="background:${dotColor}; box-shadow:${boxShadow};"></div>
                                </div>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                }
            },

            init: async () => {
                app.setLang('zh-TW');
                const userId = app.getUserId();
                const displayId = userId === DEMO_ID ? "Demo Mode" : userId.substring(0,6) + "...";
                
                document.getElementById('userIdDisplay').innerText = displayId;
                document.getElementById('debug-id').innerText = userId;

                try {
                    const res = await fetch(`${API_BASE}/?user_id=${userId}`);
                    if (!res.ok) throw new Error("API Error");
                    const json = await res.json();
                    if(json.error) throw new Error(json.error);
                    app.render(json);
                } catch (e) {
                    console.error(e);
                    app.showError("Network Connection Failed");
                }
            }
        };

        app.init();
    </script>
</body>
</html>
